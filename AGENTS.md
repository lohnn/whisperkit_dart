# Agent Guide

This document provides instructions for AI agents working on the `whisper_dart` repository.

## Project Overview

`whisper_dart` is a Dart FFI wrapper for the [WhisperKit](https://github.com/argentlabs/WhisperKit) Swift library. It allows running Whisper speech-to-text models on macOS using CoreML.

### Structure

*   **`lib/`**: Dart source code.
    *   `whisper_dart.dart`: Main wrapper class (`Whisper`).
    *   `generated_bindings.dart`: FFI bindings generated by `ffigen`.
*   **`bin/`**: CLI entry point (`whisper_dart.dart`).
*   **`native/`**: Swift library source code.
    *   `Sources/WhisperWrapper/`: Swift implementation and C-compatible header.
*   **`test/`**: Integration tests.

## Workflows

### Building Native Library

If you modify files in `native/`, you **MUST** rebuild the Swift library:

```bash
cd native
swift build -c release
cd ..
```

### Generating Bindings

If you modify `native/Sources/WhisperWrapper/include/WhisperWrapper.h`, you **MUST** regenerate the Dart bindings:

```bash
dart run ffigen --config ffigen.yaml
```

### Running Tests

Always run tests after making changes to ensure functionality:

```bash
dart test
```

**IMPORTANT**: Tests must always adhere to the project's lint rules. Run `dart analyze` to verify.

### Linting

The project uses `very_good_analysis` for strict linting. Ensure code is clean:

```bash
dart analyze
```

## Documentation Maintenance

**CRITICAL RULE**: You **MUST** keep `README.md` and Dart documentation comments up to date with any code changes.

*   If you add/change CLI flags, update the "CLI Usage" section in `README.md`.
*   If you modify the `Whisper` class API, update the "Library Usage" section in `README.md` and the corresponding Dartdoc comments in `lib/whisper_dart.dart`.
*   Ensure `AGENTS.md` (this file) is updated if workflows change.

## General Rules

*   **ALWAYS** end your task by running `dart analyze` to ensure no lint errors were introduced. Fix any issues before notifying the user.
